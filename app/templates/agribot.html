{% extends "base.html" %}

{% block title %}AgriBot – AgriHelper{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="text-center mb-5 text-success">AgriBot</h2>
  <div class="row justify-content-center">
    <div class="col-md-6 text-center">
      <form id="chatbot-form" method="POST">
        <input type="text" name="question" id="question" class="form-control mb-3" placeholder="Posez votre question ici" required>
        <button type="submit" class="btn btn-success w-100">Envoyer</button>
      </form>
      <div id="chatbot-response" class="alert mt-3 d-none" role="alert"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $("#chatbot-form").on("submit", function(e) {
    e.preventDefault();
    const q = $("#question").val();
    const $res = $("#chatbot-response");

    $res.removeClass("d-none alert-danger alert-success").html("Chargement...");

    $.post("{{ url_for('main.agribot') }}", { question: q })
      .done(res => {
        $res
          .addClass("alert-success")
          .html(`<strong>Réponse :</strong> ${res.response}`);
      })
      .fail(xhr => {
        const msg = xhr.responseJSON?.error || "Erreur inconnue.";
        $res
          .addClass("alert-danger")
          .html(`<strong>Erreur :</strong> ${msg}`);
      });
  });
</script>
{% endblock %}
