{% extends "base.html" %}

{% block title %}AgriBot – AgriHelper{% endblock %}

{% block head %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="text-center mb-5 text-success">AgriBot</h2>
  <div class="row justify-content-center">
    <div class="col-md-6">
      <form id="chatbot-form" method="POST">
        <input type="text" name="question" id="question" class="form-control mb-3 bg-light" placeholder="Posez une question à AgriBot..." required>
        <button type="submit" class="btn btn-success w-100">Envoyer</button>
      </form>

      <div id="chatbot-response" class="mt-4 alert d-none" role="alert"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $("#chatbot-form").on("submit", function(e) {
    e.preventDefault();
    const question = $("#question").val();
    const $responseBox = $("#chatbot-response");

    $.post("{{ url_for('main.agribot') }}", { question: question })
      .done(res => {
        const content = res.response ? `<strong>AgriBot :</strong> ${res.response}` : `<strong>Erreur :</strong> ${res.error}`;
        $responseBox.removeClass("d-none alert-danger").addClass("alert-success").html(content);
      })
      .fail(() => {
        $responseBox.removeClass("d-none alert-success").addClass("alert-danger").html("<strong>Erreur :</strong> Impossible d’obtenir une réponse pour l’instant.");
      });
  });
</script>
{% endblock %}
