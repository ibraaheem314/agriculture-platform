{% extends "base.html" %}

{% block title %}Résultats personnalisés - AgriHelper{% endblock %}

{% block content %}
<h2 class="text-center mb-4">Résultats pour {{ location or 'vos coordonnées' }}</h2>

<!-- Section carte interactive -->
<div id="interactive-map" style="height: 400px;" class="mb-5"></div>

<!-- Section prévisions météo -->
<section class="mt-5">
    <h3 class="text-center mb-4"><i class="fas fa-cloud-sun"></i> Prévisions météo</h3>
    {% if weather_data %}
    <div class="card text-center">
        <div class="card-body">
            <p class="card-text">Température : {{ weather_data[0].temp }}°C</p>
            <p class="card-text">Description : {{ weather_data[0].description }}</p>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning text-center">Impossible de récupérer les prévisions météo.</div>
    {% endif %}
</section>

<!-- Section pollution -->
<section class="mt-5">
    <h3 class="text-center mb-4"><i class="fas fa-smog"></i> Pollution de l'air</h3>
    {% if pollution_data %}
    <div class="card text-center">
        <div class="card-body">
            <p class="card-text">Indice AQI : {{ pollution_data.aqi }}</p>
            <p class="card-text">Qualité de l'air : {{ pollution_data.quality }}</p>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning text-center">Impossible de récupérer les données de pollution.</div>
    {% endif %}
</section>

<!-- Section typologie des sols -->
<section class="mt-5">
    <h3 class="text-center mb-4"><i class="fas fa-seedling"></i> Typologie des sols</h3>
    {% if soil_data is not none %}
    <div class="card text-center">
        <div class="card-body">
            <p class="card-text">Teneur en argile : {{ soil_data }}%</p>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning text-center">Impossible de récupérer les données sur les sols.</div>
    {% endif %}
</section>

<!-- Section Nos outils -->
<section class="tools-section mt-5">
    <h2 class="text-center mb-4">Nos outils pour vous accompagner à {{ location or 'vos coordonnées' }}</h2>
    <div class="row">
        <div class="col-md-4 text-center">
            <div class="card h-100">
                <div class="card-body">
                    <i class="fas fa-calendar-alt fa-3x mb-3"></i>
                    <h5 class="card-title">Prévisions météo précises</h5>
                    <p class="card-text">Consultez les prévisions météo détaillées pour {{ location or 'cette région' }}.</p>
                    <a href="/meteo-semaine" class="btn btn-primary">Accéder</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="card h-100">
                <div class="card-body">
                    <i class="fas fa-cloud fa-3x mb-3"></i>
                    <h5 class="card-title">Cartes de pollution</h5>
                    <p class="card-text">Visualisez les zones de pollution de l'air et des sols autour de {{ location or 'cette région' }}.</p>
                    <a href="/pollution" class="btn btn-primary">Accéder</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <div class="card h-100">
                <div class="card-body">
                    <i class="fas fa-globe-africa fa-3x mb-3"></i>
                    <h5 class="card-title">Typologie des sols</h5>
                    <p class="card-text">Découvrez les caractéristiques des sols autour de {{ location or 'cette région' }}.</p>
                    <a href="/typologie-sols" class="btn btn-primary">Accéder</a>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script>
    // Initialiser la carte
    var map = L.map('interactive-map').setView([{{ lat }}, {{ lon }}], 13);

    // Ajouter une couche de tuiles OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Ajouter un marqueur à la position spécifiée
    L.marker([{{ lat }}, {{ lon }}]).addTo(map)
        .bindPopup("Votre emplacement : {{ location or 'Coordonnées GPS' }}")
        .openPopup();
</script>
{% endblock %}